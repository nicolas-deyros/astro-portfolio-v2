---
export const prerender = true
import Section from '@components/Section.astro'
import Layout from '@layouts/index.astro'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
	const allPosts = await getCollection('blog')
	const uniqueCategories = [
		...new Set(allPosts.map(post => post.data.category)),
	]

	return uniqueCategories.map(category => {
		const filteredPosts = allPosts.filter(
			post => post.data.category === category,
		)
		return {
			params: { category },
			props: { posts: filteredPosts, category },
		}
	})
}

const { posts, category } = Astro.props
---

<Layout
	title={`Blog | ${category}`}
	description={`All blog posts in the ${category} category.`}>
	<Section ariaLabel={`Blog Category: ${category}`}>
		<div class="mb-8">
			<h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100">
				Posts in <span class="text-blue-600">{category}</span>
			</h1>
			<p class="mt-2 text-slate-600 dark:text-slate-400">
				{posts.length}
				{posts.length === 1 ? 'post' : 'posts'} found
			</p>
		</div>

		<div class="space-y-6">
			{
				posts.map(post => (
					<article class="border-b border-slate-200 pb-6 dark:border-slate-700">
						<header class="mb-3">
							<h2 class="text-xl font-bold text-slate-900 dark:text-slate-100">
								<a
									href={`/blog/${post.slug}/`}
									class="hover:text-blue-600 dark:hover:text-blue-400">
									{post.data.title}
								</a>
							</h2>
							<div class="mt-2 flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400">
								<time datetime={new Date(post.data.date).toISOString()}>
									{new Date(post.data.date).toLocaleDateString('en-us', {
										year: 'numeric',
										month: 'long',
										day: 'numeric',
									})}
								</time>
								{post.data.author && <span>by {post.data.author}</span>}
							</div>
						</header>

						{post.data.description && (
							<p class="mb-4 text-slate-700 dark:text-slate-300">
								{post.data.description}
							</p>
						)}

						<a
							href={`/blog/${post.slug}/`}
							class="inline-flex items-center text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300">
							Read more →
						</a>
					</article>
				))
			}
		</div>

		<!-- Back to all posts link -->
		<div class="mt-8">
			<a
				href="/blog/categories/"
				class="text-blue-600 hover:text-blue-700 dark:text-blue-400">
				← Back to all categories
			</a>
		</div>
	</Section>
</Layout>
